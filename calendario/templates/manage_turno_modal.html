<script>
var states = ['DISPONILE','ASIGNADO','CONFIRMADO','ATENDIDO','CANCELADO_PACIENTE','CANCELADO_ESTABLECIMIENTO']

function cargarData(data){
  $("#title").html(data.title);
  $("#start").html(formatDatetime(data.start));
  $("#state").html(states[data.extendedProps.status]);
  if (data.extendedProps.status == 1){
    /*Solo se podra confirmar el turno cuando este ASIGNADO
      y el paciente llegue */
    $("#btnConfirmar").prop('disabled','');
  }
  else{
    $("#btnConfirmar").prop('disabled','disabled');
  }
  $("#idTurno").val(data.id);
}

function editarEstadoTurno(estado){
  let formData = {
    'id': $("#idTurno").val(),
    'state': estado,
  }
  axios({
    method: 'put',
    url: "{% url 'calendario.edit_turn' pk=0 %}".replace(0,$("#idTurno").val()),
    headers: {'Content-Type': 'application/json'},
    data: formData
  })
    .then(response => {
      if (!response.data.success) {
        console.error(response.data.errors);
      } else {
        calendar.refetchEvents();
        $('#manageTurnoModal').modal('hide');
      }
    })
    .catch(error => {
      showFormErrors({Error: [error.toString().slice(7)]});
    });
}

function confirmarTurno(){
  //CONFIRMADO = 2
  editarEstadoTurno(2);
}

function cancelarTurno(){
  //CANCELADO_ESTABLECIMIENTO = 5
  editarEstadoTurno(5);
}
</script>

<div class="modal fade" id="manageTurnoModal" tabindex="1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Modificar turno</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h1 id="title"></h1>
        <p>Fecha: <strong id="start"></strong></p>
        <p>Estado: <strong id="state"></strong></p>
      </div>
      <input hidden id="idTurno">
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" onclick="cancelarTurno()">Cancelar Turno</button>
        <button type="button" class="btn btn-primary" id='btnConfirmar'
          onclick="confirmarTurno()">Confirmar</button>
      </div>
    </div>
  </div>
</div>